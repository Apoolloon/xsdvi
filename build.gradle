plugins{
//    id 'java'
    id 'java-library'
}

repositories {
    jcenter()
    mavenLocal()
    flatDir{dirs 'lib'}
//    fileTree(dir: 'lib', include: '*.jar')
}

dependencies {
//    implementation name: 'xercesImpl'
    implementation fileTree('lib') {include '*.jar'}
//    implementation files('lib/xercesImpl.jar')
//    implementation 'xerces:xercesImpl:2.9.0'
//    implementation 'org.apache.xerces:com.springsource.org.apache.xerces:2.9.0'
//    implementation 'org.w3c:dom:2.3.0-jaxb-1.0.6'
//    implementation 'apache-xerces:xercesImpl:2.9.0'
}

sourceSets {
    main {
        java { srcDirs = ['src'] }
        resources { srcDirs = ['res', 'lib'] }
    }
}

jar {
    manifest {
        attributes(
                'Implementation-Title': project.name,
                'Implementation-Version': project.version,
//                'Class-Path': configurations.compile.collect { it.getName() }.join(' '),
                'Class-Path': 'xercesImpl.jar',
                'Main-Class': 'xsdvi.XsdVi'
        )
    }
}

version = '1.1.1'

task configure {
    dependsOn(dependencies)
//    apply from: "${projectDir}/legacy-ant-tsks.gradle"
    apply from: "${projectDir}/legacy-ant-props.gradle"
    dependsOn(showAntProps)
    println 'TRACER my configure task from main build.gradle'
}

task distribution {
//    dependsOn(configure)
    dependsOn(build)
    doLast {
        println "We build with version=$version"
        println "get it at ${buildDir}\\${project.ext.buildLocation}"
    }
}

task release {
    dependsOn(distribution)
    doLast {
        println 'We release now'
    }
}

gradle.taskGraph.whenReady { taskGraph ->
    if (taskGraph.hasTask(":release")) {
        println "take it baby"
    } else {
        version = version + '-SNAPSHOT'
    }
}

task genFaktura(type:Exec){
    dependsOn(distribution)
    group = 'gen'
    workingDir projectDir
    commandLine 'cmd', '/c', 'java -jar build\\libs\\xsdvi-1.1.1-SNAPSHOT.jar build\\resources\\main\\examples\\xsd\\faktura.xsd'
    standardOutput = new ByteArrayOutputStream()
    ext.output = {
        return standardOutput.toString()
    }
}

task tests{
    group = 'gen'
    dependsOn genFaktura
    doLast {
        println('TRACER tests runned')
    }
}